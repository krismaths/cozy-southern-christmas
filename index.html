<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Cozy Southern Christmas — Holiday Preorders</title>
  <link href="https://fonts.googleapis.com/css2?family=Cinzel+Decorative:wght@400;700&family=Raleway:wght@300;400;600&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg:#F4F3ED;--near-black:#1A1A1B;--deep-plum:#4B3F4E;--muted:#6c6c6c;--card:#fff;
      font-family:"Raleway",system-ui,-apple-system,"Segoe UI",Roboto,Arial;
    }
    html,body{margin:0;background:linear-gradient(#fbfbfa,#f4f3ed);color:var(--near-black);-webkit-font-smoothing:antialiased;}
    .container{max-width:1100px;margin:28px auto;padding:24px;}
    header.hero{display:grid;grid-template-columns:1fr 360px;gap:22px;align-items:center;margin-bottom:20px;}
    .hero-left h1{font-family:"Cinzel Decorative",serif;font-size:36px;margin:0;color:var(--deep-plum)}
    .cta-row{display:flex;gap:10px;margin-top:10px}
    .btn{background:var(--deep-plum);color:#fff;border-radius:10px;padding:10px 14px;border:0;cursor:pointer;font-weight:700}
    .btn.secondary{background:transparent;color:var(--deep-plum);border:2px solid var(--deep-plum)}
    .section{background:linear-gradient(white,#fbfbfa);padding:14px;border-radius:12px;margin-bottom:16px;box-shadow:0 6px 14px rgba(20,20,20,0.03)}
    .grid-2{display:grid;grid-template-columns:repeat(2,1fr);gap:12px}
    .card{background:var(--card);padding:12px;border-radius:10px;border:1px solid rgba(0,0,0,0.04)}
    .product-row{display:flex;justify-content:space-between;align-items:center;padding:8px 0;border-bottom:1px dashed #eee}
    .product-left{display:flex;gap:12px;align-items:center}
    .thumb{width:72px;height:52px;background:linear-gradient(#eee,#ddd);border-radius:8px;display:flex;align-items:center;justify-content:center;color:var(--muted);font-size:12px}
    .prod-title{font-weight:700}
    .price{font-weight:700;color:var(--deep-plum)}
    .qty{display:flex;align-items:center;border-radius:10px;border:1px solid #e6e4e1;padding:4px;background:#fff}
    .qty button{background:transparent;border:0;padding:8px 10px;font-weight:700;color:var(--deep-plum);cursor:pointer}
    .qty input{width:48px;text-align:center;border:0;font-weight:700}
    .summary{position:sticky;top:14px;background:var(--card);padding:14px;border-radius:12px;border:1px solid rgba(0,0,0,0.04);box-shadow:0 10px 28px rgba(30,30,30,0.04)}
    .muted{color:var(--muted);font-size:14px}
    label{cursor:pointer}
    @media (max-width:980px){header.hero{grid-template-columns:1fr;gap:12px}.grid-2{grid-template-columns:1fr}.summary{position:static;margin-top:12px}}
  </style>
</head>
<body>
  <div class="container">
    <header class="hero">
      <div class="hero-left">
        <h1>Cozy Southern Christmas</h1>
        <p class="muted">Make Christmas Day simple and delicious. Preorders close Dec 19 • Pickup Dec 24 (S. Wall Ave, Joplin).</p>
        <div class="cta-row"><button class="btn" id="jump-order">Order Now</button><button class="btn secondary" id="download-menu">Download Menu</button></div>
        <p class="muted" style="margin-top:10px">Choose a bundle up top, or scroll down to order à la carte. Bundles are fixed; extras may be added at 10% off.</p>
      </div>

      <aside class="card">
        <div style="font-weight:700;color:var(--deep-plum)">Quick Info</div>
        <ul class="muted" style="padding-left:18px;margin-top:8px">
          <li>Ham Bundle — $120 (feeds multiple)</li>
          <li>Gumbo Bundle — $125 (signature)</li>
          <li>Breakfasts & pies: feed 6–8 • Dinners: feed ~4</li>
        </ul>
      </aside>
    </header>

    <!-- NEW: Bundle chooser (top) -->
    <section class="section card" id="bundle-chooser">
      <h3 style="margin-top:0;color:var(--deep-plum);font-family:'Cinzel Decorative',serif">Choose a bundle — or scroll for à la carte</h3>
      <div style="display:flex;gap:14px;align-items:center;flex-wrap:wrap">
        <label style="display:flex;align-items:center;gap:8px"><input type="radio" name="bundle" value="none" checked> No bundle</label>

        <label style="display:flex;align-items:center;gap:8px">
          <input type="radio" name="bundle" value="ham"> Ham Bundle — <strong>$120</strong>
        </label>

        <label style="display:flex;align-items:center;gap:8px">
          <input type="radio" name="bundle" value="gumbo"> Gumbo Bundle — <strong>$125</strong>
        </label>

        <div style="margin-left:6px;display:flex;align-items:center;gap:8px">
          <div class="muted">Quantity</div>
          <!-- hidden-ish qty inputs used by pricing logic; they match data-key the recalc expects -->
          <div class="qty"><button class="dec" data-bundle-qty>-</button><input data-key="bundle-ham" id="bundle-ham-qty" class="qty-input" type="number" min="0" value="0" data-price="120"><button class="inc" data-bundle-qty>+</button></div>
        </div>

        <!-- We'll store gumbo qty in separate input but same visible control (sync below) -->
        <input data-key="bundle-gumbo" id="bundle-gumbo-qty" class="qty-input" type="number" min="0" value="0" data-price="125" style="display:none">
      </div>

      <div style="margin-top:12px" class="muted">
        After selecting a bundle and quantity, scroll down to pick the included breakfast choice and pie for your bundle(s). The order cannot be completed until each bundle has a breakfast and a pie selection.
      </div>

      <div style="margin-top:12px">
        <div id="bundle-warning" style="color:#8B1E3F;font-weight:700;display:none">Please choose breakfast & pie for each selected bundle before submitting.</div>
      </div>
    </section>

    <!-- Main ordering area -->
    <div style="display:grid;grid-template-columns:1fr 360px;gap:18px;align-items:start">
      <main>

        <!-- BUNDLES DETAIL (choices for bundle contents) -->
        <section class="section" id="bundle-choices">
          <h3 style="margin-top:0;color:var(--deep-plum);font-family:'Cinzel Decorative',serif">Bundle selections (if you picked a bundle)</h3>
          <div class="card" style="margin-bottom:12px">
            <div style="display:flex;gap:12px;flex-wrap:wrap;align-items:center">
              <div style="flex:1;min-width:220px">
                <div class="muted">Ham Bundle — Breakfast choice</div>
                <select id="bundle-ham-breakfast" style="width:100%;padding:8px;border-radius:8px;border:1px solid #e8e6e3">
                  <option value="">Choose breakfast</option>
                  <option value="classic-rolls">Classic Cinnamon Rolls</option>
                  <option value="sticky-rolls">Caramel Sticky Rolls</option>
                  <option value="french-toast">French Toast Casserole</option>
                </select>
              </div>
              <div style="flex:1;min-width:220px">
                <div class="muted">Ham Bundle — Pie choice</div>
                <select id="bundle-ham-pie" style="width:100%;padding:8px;border-radius:8px;border:1px solid #e8e6e3">
                  <option value="">Choose pie</option>
                  <option value="pie-lemon">Lemon Buttermilk</option>
                  <option value="pie-sweetpot">Maple Sweet Potato</option>
                  <option value="pie-apple">Apple Crumble</option>
                  <option value="pie-pecan">Brown Butter Pecan</option>
                  <option value="pie-midnight">Midnight Chocolate Pecan</option>
                </select>
              </div>
            </div>

            <hr style="margin:12px 0">

            <div style="display:flex;gap:12px;flex-wrap:wrap;align-items:center">
              <div style="flex:1;min-width:220px">
                <div class="muted">Gumbo Bundle — Breakfast choice</div>
                <select id="bundle-gumbo-breakfast" style="width:100%;padding:8px;border-radius:8px;border:1px solid #e8e6e3">
                  <option value="">Choose breakfast</option>
                  <option value="classic-rolls">Classic Cinnamon Rolls</option>
                  <option value="sticky-rolls">Caramel Sticky Rolls</option>
                  <option value="french-toast">French Toast Casserole</option>
                </select>
              </div>
              <div style="flex:1;min-width:220px">
                <div class="muted">Gumbo Bundle — Pie choice</div>
                <select id="bundle-gumbo-pie" style="width:100%;padding:8px;border-radius:8px;border:1px solid #e8e6e3">
                  <option value="">Choose pie</option>
                  <option value="pie-lemon">Lemon Buttermilk</option>
                  <option value="pie-sweetpot">Maple Sweet Potato</option>
                  <option value="pie-apple">Apple Crumble</option>
                </select>
              </div>
            </div>
          </div>
        </section>

        <!-- ALA CARTE SECTIONS (Breakfast, Midday, Dinner, Desserts) -->
        <section class="section" id="menu">
          <h2 style="font-family:'Cinzel Decorative',serif;color:var(--deep-plum);margin-top:0">Order à la carte</h2>

          <!-- Breakfast -->
          <h3>Breakfast (feeds 6–8)</h3>
          <div class="card" style="margin-bottom:12px">
            <div class="product-row" data-key="classic-rolls" data-price="30">
              <div class="product-left"><div class="thumb">Rolls</div><div><div class="prod-title">Classic Cinnamon Roll Tin</div><div class="muted">Baked: $30 · Bake-at-home: $28</div></div></div>
              <div><div class="price">$30</div><div style="margin-top:8px" class="qty"><button class="dec">−</button><input data-key="classic-rolls" class="qty-input" type="number" min="0" value="0"><button class="inc">+</button></div></div>
            </div>

            <div class="product-row" data-key="sticky-rolls" data-price="36">
              <div class="product-left"><div class="thumb">Sticky</div><div><div class="prod-title">Caramel Pecan Sticky Roll Tin</div><div class="muted">Baked: $36 · Bake-at-home: $34</div></div></div>
              <div><div class="price">$36</div><div style="margin-top:8px" class="qty"><button class="dec">−</button><input data-key="sticky-rolls" class="qty-input" type="number" min="0" value="0"><button class="inc">+</button></div></div>
            </div>

            <div class="product-row" data-key="french-toast" data-price="30">
              <div class="product-left"><div class="thumb">FT</div><div><div class="prod-title">French Toast Casserole</div><div class="muted">Vanilla-cinnamon custard & crumble.</div></div></div>
              <div><div class="price">$30</div><div style="margin-top:8px" class="qty"><button class="dec">−</button><input data-key="french-toast" class="qty-input" type="number" min="0" value="0"><button class="inc">+</button></div></div>
            </div>
          </div>

          <!-- Midday Snack -->
          <h3>Midday Snack</h3>
          <div class="card" style="margin-bottom:12px">
            <div class="product-row" data-key="grazing-box" data-price="35">
              <div class="product-left"><div class="thumb">Box</div><div><div class="prod-title">Southern Grazing Box</div><div class="muted">Cheeses, meats, fruit & a small sweet.</div></div></div>
              <div><div class="price">$35</div><div style="margin-top:8px" class="qty"><button class="dec">−</button><input data-key="grazing-box" class="qty-input" type="number" min="0" value="0"><button class="inc">+</button></div></div>
            </div>
          </div>

          <!-- Dinners -->
          <h3>Dinners (each feeds ~4)</h3>
          <div class="grid-2" style="margin-bottom:12px">
            <div class="card" data-key="ham" data-price="40">
              <h4 style="margin:0 0 8px">Brown Sugar Glazed Ham Dinner — <span class="price">$40</span></h4>
              <div class="muted">Includes ham & rolls.</div>
              <div style="margin-top:10px"><div class="qty"><button class="dec">−</button><input data-key="ham" class="qty-input" type="number" min="0" value="0"><button class="inc">+</button></div></div>
            </div>

            <div class="card" data-key="gumbo" data-price="45">
              <h4 style="margin:0 0 8px">Signature Holiday Gumbo Dinner — <span class="price">$45</span></h4>
              <div class="muted">Served with rice, cornbread & potato salad.</div>
              <div style="margin-top:10px"><div class="qty"><button class="dec">−</button><input data-key="gumbo" class="qty-input" type="number" min="0" value="0"><button class="inc">+</button></div></div>

              <div style="margin-top:10px">
                <div class="muted">Add-on: Deviled Eggs</div>
                <div style="display:flex;gap:10px;margin-top:8px">
                  <div><div style="font-size:13px" class="muted">½ dozen</div><div class="qty" style="margin-top:6px"><button class="dec">−</button><input data-key="deviled-hf" class="qty-input" data-price="6" type="number" min="0" value="0"><button class="inc">+</button></div></div>
                  <div><div style="font-size:13px" class="muted">Dozen</div><div class="qty" style="margin-top:6px"><button class="dec">−</button><input data-key="deviled-doz" class="qty-input" data-price="10" type="number" min="0" value="0"><button class="inc">+</button></div></div>
                </div>
              </div>
            </div>
          </div>

          <!-- Sides -->
          <h3>Sides (each $10)</h3>
          <div class="card" style="margin-bottom:12px">
            <div class="product-row" data-key="side-mac" data-price="10"><div class="product-left"><div class="thumb">Side</div><div><div class="prod-title">Mac & Cheese</div></div></div><div><div class="price">$10</div><div class="qty"><button class="dec">−</button><input data-key="side-mac" class="qty-input" type="number" min="0" value="0"><button class="inc">+</button></div></div></div>
            <div class="product-row" data-key="side-mashed" data-price="10"><div class="product-left"><div class="thumb">Side</div><div><div class="prod-title">Mashed Potatoes</div></div></div><div><div class="price">$10</div><div class="qty"><button class="dec">−</button><input data-key="side-mashed" class="qty-input" type="number" min="0" value="0"><button class="inc">+</button></div></div></div>
            <div class="product-row" data-key="side-greenbeans" data-price="10"><div class="product-left"><div class="thumb">Side</div><div><div class="prod-title">Green Bean Casserole</div></div></div><div><div class="price">$10</div><div class="qty"><button class="dec">−</button><input data-key="side-greenbeans" class="qty-input" type="number" min="0" value="0"><button class="inc">+</button></div></div></div>
            <div class="product-row" data-key="side-corn" data-price="10"><div class="product-left"><div class="thumb">Side</div><div><div class="prod-title">Sweet Cream Fiesta Corn</div></div></div><div><div class="price">$10</div><div class="qty"><button class="dec">−</button><input data-key="side-corn" class="qty-input" type="number" min="0" value="0"><button class="inc">+</button></div></div></div>
          </div>

          <!-- Desserts / Pies -->
          <h3>Desserts</h3>
          <div class="card" style="margin-bottom:12px">
            <div class="product-row" data-key="pie-lemon" data-price="26"><div class="product-left"><div class="thumb">Pie</div><div><div class="prod-title">Lemon Buttermilk</div></div></div><div><div class="price">$26</div><div class="qty"><button class="dec">−</button><input data-key="pie-lemon" class="qty-input" type="number" min="0" value="0"><button class="inc">+</button></div></div></div>
            <div class="product-row" data-key="pie-sweetpot" data-price="28"><div class="product-left"><div class="thumb">Pie</div><div><div class="prod-title">Maple Sweet Potato</div></div></div><div><div class="price">$28</div><div class="qty"><button class="dec">−</button><input data-key="pie-sweetpot" class="qty-input" type="number" min="0" value="0"><button class="inc">+</button></div></div></div>
            <div class="product-row" data-key="pie-apple" data-price="30"><div class="product-left"><div class="thumb">Pie</div><div><div class="prod-title">Apple Crumble</div></div></div><div><div class="price">$30</div><div class="qty"><button class="dec">−</button><input data-key="pie-apple" class="qty-input" type="number" min="0" value="0"><button class="inc">+</button></div></div></div>
            <div class="product-row" data-key="pie-pecan" data-price="36"><div class="product-left"><div class="thumb">Pie</div><div><div class="prod-title">Brown Butter Bourbon Pecan</div></div></div><div><div class="price">$36</div><div class="qty"><button class="dec">−</button><input data-key="pie-pecan" class="qty-input" type="number" min="0" value="0"><button class="inc">+</button></div></div></div>
            <div class="product-row" data-key="pie-midnight" data-price="38"><div class="product-left"><div class="thumb">Pie</div><div><div class="prod-title">Midnight Chocolate Pecan</div></div></div><div><div class="price">$38</div><div class="qty"><button class="dec">−</button><input data-key="pie-midnight" class="qty-input" type="number" min="0" value="0"><button class="inc">+</button></div></div></div>
          </div>
        </section>
      </main>

      <!-- RIGHT: summary & order -->
      <aside class="summary">
        <h4 style="margin:0 0 8px">Your Order</h4>
        <div id="order-lines" style="max-height:380px;overflow:auto;margin-bottom:10px"><div class="muted">No items yet.</div></div>
        <div style="display:flex;justify-content:space-between"><div class="muted">Subtotal</div><div id="subtotal">$0.00</div></div>
        <div style="display:flex;justify-content:space-between"><div class="muted">Discounts</div><div id="discounts">-$0.00</div></div>
        <div style="display:flex;justify-content:space-between;margin-top:8px;font-weight:800;font-size:18px"><div>Total</div><div id="total">$0.00</div></div>

        <div style="margin-top:12px"><label style="display:block;margin-bottom:6px">Name</label><input id="cust-name" style="width:100%;padding:8px;border-radius:8px;border:1px solid #e8e6e3"></div>
        <div style="margin-top:8px"><label style="display:block;margin-bottom:6px">Phone or Email</label><input id="cust-contact" style="width:100%;padding:8px;border-radius:8px;border:1px solid #e8e6e3"></div>

        <div style="margin-top:10px"><label style="display:block;margin-bottom:6px">Payment Method</label><select id="payment-method" style="width:100%;padding:8px;border-radius:8px;border:1px solid #e8e6e3"><option value="venmo">Venmo</option><option value="paypal">PayPal</option><option value="square">Square (card)</option></select></div>

        <div style="margin-top:12px;display:flex;gap:8px">
          <button class="btn" id="submit-order">Submit Order</button>
          <button class="btn secondary" id="reset-order">Reset</button>
        </div>

        <div class="muted" style="margin-top:12px">Payment holds your order. After submitting you'll get payment instructions with Venmo (@krismaths) / PayPal (krismaths5@gmail.com) / Square placeholder.</div>
      </aside>
    </div>

    <footer style="margin-top:18px;text-align:center;color:var(--muted)">Cozy Southern Christmas — Made with ❤️ in a home kitchen. Orders confirmed after payment.</footer>
  </div>

  <script>
    /* helpers */
    const money = v=>"$"+(Math.round((v+Number.EPSILON)*100)/100).toFixed(2);
    const n = v=>Number(v||0);

    /* recalc / read quantities */
    function readQuantities(){
      const q = {};
      document.querySelectorAll('.qty-input').forEach(inp=>{
        const key = inp.getAttribute('data-key');
        if(!key) return;
        const priceAttr = inp.getAttribute('data-price') || (inp.closest('[data-key]') && inp.closest('[data-key]').getAttribute('data-price')) || 0;
        const price = n(priceAttr);
        const qty = Math.max(0, Math.floor(n(inp.value)));
        q[key] = { qty, price };
      });
      return q;
    }

    function labelForKey(k){
      return {
        'classic-rolls':'Classic Cinnamon Roll Tin',
        'sticky-rolls':'Caramel Pecan Sticky Rolls',
        'french-toast':'French Toast Casserole',
        'grazing-box':'Southern Grazing Box',
        'ham':'Brown Sugar Glazed Ham Dinner',
        'gumbo':'Signature Holiday Gumbo Dinner',
        'deviled-hf':'Deviled Eggs (1/2 doz)',
        'deviled-doz':'Deviled Eggs (dozen)',
        'side-mac':'Mac & Cheese',
        'side-mashed':'Mashed Potatoes',
        'side-greenbeans':'Green Bean Casserole',
        'side-corn':'Sweet Cream Fiesta Corn',
        'pie-lemon':'Lemon Buttermilk Pie',
        'pie-sweetpot':'Maple Sweet Potato Pie',
        'pie-apple':'Apple Crumble Pie',
        'pie-pecan':'Brown Butter Bourbon Pecan Pie',
        'pie-midnight':'Midnight Chocolate Pecan Pie',
        'bundle-ham':'Ham Christmas Bundle',
        'bundle-gumbo':'Gumbo Christmas Bundle'
      }[k] || k;
    }

    function recalc(){
      const q = readQuantities();
      const lines = [];
      let subtotal = 0;
      let discounts = 0;

      // Bundles: bundle-ham and bundle-gumbo are data-keys on inputs
      if(q['bundle-ham'] && q['bundle-ham'].qty>0){
        const qty = q['bundle-ham'].qty;
        const unit = q['bundle-ham'].price || 120;
        lines.push({label:labelForKey('bundle-ham'), qty, unit, total: unit*qty, note:'Bundle (fixed)'});
        subtotal += unit*qty;
      }
      if(q['bundle-gumbo'] && q['bundle-gumbo'].qty>0){
        const qty = q['bundle-gumbo'].qty;
        const unit = q['bundle-gumbo'].price || 125;
        lines.push({label:labelForKey('bundle-gumbo'), qty, unit, total: unit*qty, note:'Bundle (fixed)'});
        subtotal += unit*qty;
      }

      // non-bundle items
      document.querySelectorAll('.product-row[data-key]').forEach(row=>{
        const key = row.getAttribute('data-key');
        if(key==='bundle-ham' || key==='bundle-gumbo') return; // not used here
        const inp = document.querySelector('.qty-input[data-key="'+key+'"]');
        const qty = inp ? Math.max(0, Math.floor(n(inp.value))) : 0;
        const unit = n(row.getAttribute('data-price')|| (inp?inp.getAttribute('data-price'):0) || 0);
        if(qty>0){
          lines.push({label:labelForKey(key), qty, unit, total: unit*qty, note:''});
          subtotal += unit*qty;
        }
      });

      // NOTE: Add-on discount logic: if any bundles present, all standalone items are treated as add-ons at 10% off
      const bundleCount = (q['bundle-ham']?q['bundle-ham'].qty:0) + (q['bundle-gumbo']?q['bundle-gumbo'].qty:0);
      if(bundleCount>0){
        // adjust lines that are not bundles
        lines.forEach(l=>{
          if(l.label !== labelForKey('bundle-ham') && l.label !== labelForKey('bundle-gumbo')){
            const base = l.total;
            const disc = base*0.10;
            l.total = base - disc;
            discounts += disc;
          }
        });
        subtotal = lines.reduce((s,l)=> s + l.total, 0);
      } else {
        // no bundles: leave as-is (multi-item pie+breakfast discount omitted for simplicity)
      }

      renderSummary(lines, subtotal, discounts);
    }

    function renderSummary(lines, subtotal, discounts){
      const container = document.getElementById('order-lines');
      container.innerHTML = '';
      if(lines.length===0) container.innerHTML = '<div class="muted">No items yet.</div>';
      else {
        lines.forEach(l=>{
          const row = document.createElement('div');
          row.style.display='flex';row.style.justifyContent='space-between';row.style.marginBottom='6px';
          const left = document.createElement('div'); left.innerText = (l.qty>1? l.qty + ' × ' :'') + l.label;
          left.style.fontSize='14px';
          const right = document.createElement('div'); right.style.fontWeight='700'; right.innerText = money(l.total);
          row.appendChild(left); row.appendChild(right); container.appendChild(row);
          if(l.note){ const note = document.createElement('div'); note.className='muted'; note.style.fontSize='12px'; note.style.marginBottom='8px'; note.innerText = l.note; container.appendChild(note); }
        });
      }
      document.getElementById('subtotal').innerText = money(subtotal);
      document.getElementById('discounts').innerText = "-" + money(discounts);
      document.getElementById('total').innerText = money(Math.max(0, subtotal));
    }

    /* quantity controls - generic */
    function incDecSetup(){
      document.querySelectorAll('.inc').forEach(b=>b.addEventListener('click', e=>{
        const inp = e.target.closest('.qty').querySelector('.qty-input'); if(!inp) return; inp.value = Math.max(0, n(inp.value)+1); recalc();
      }));
      document.querySelectorAll('.dec').forEach(b=>b.addEventListener('click', e=>{
        const inp = e.target.closest('.qty').querySelector('.qty-input'); if(!inp) return; inp.value = Math.max(0, n(inp.value)-1); recalc();
      }));
      document.querySelectorAll('.qty-input').forEach(i=>i.addEventListener('change', e=>{ i.value = Math.max(0, Math.floor(n(i.value)||0)); recalc(); }));
    }
    incDecSetup();

    // bundle radio interactions and qty sync
    document.querySelectorAll('input[name="bundle"]').forEach(r=>{
      r.addEventListener('change', e=>{
        const val = e.target.value;
        // visually: when user picks ham/gumbo set the corresponding qty input to 1 if it was 0 and zero the other
        const hamInput = document.getElementById('bundle-ham-qty');
        const gumboInput = document.getElementById('bundle-gumbo-qty');
        if(val === 'ham'){
          if(n(hamInput.value) === 0) hamInput.value = 1;
          gumboInput.value = 0;
          // make gumbo hidden input remain present but zeroed
        } else if(val === 'gumbo'){
          if(n(gumboInput.value) === 0) gumboInput.value = 1;
          hamInput.value = 0;
        } else { // none
          hamInput.value = 0; gumboInput.value = 0;
        }
        recalc();
      });
    });

    // bundle qty +/- buttons control both visible ham qty input and hidden gumbo depending on selection
    document.querySelectorAll('[data-bundle-qty]').forEach(b=>b.addEventListener('click', e=>{
      // decide which bundle is selected
      const selected = document.querySelector('input[name="bundle"]:checked').value;
      const hamInput = document.getElementById('bundle-ham-qty');
      const gumboInput = document.getElementById('bundle-gumbo-qty');
      const inp = (selected==='ham') ? hamInput : (selected==='gumbo') ? gumboInput : null;
      if(!inp) return;
      if(e.target.classList.contains('inc') || e.target.getAttribute('data-bundle-qty') !== null && e.target.innerText === '+'){
        // not reached; fallback
      }
      // decide inc/dec using text content
      const txt = e.target.textContent.trim();
      if(txt === '+' || txt === '＋' || txt === '+') { inp.value = Math.max(0, n(inp.value)+1); }
      else if(txt === '-' || txt === '−') { inp.value = Math.max(0, n(inp.value)-1); }
      else {
        // for buttons that don't have text, attempt to use class inc/dec
        if(e.target.classList.contains('inc')) inp.value = Math.max(0, n(inp.value)+1);
        if(e.target.classList.contains('dec')) inp.value = Math.max(0, n(inp.value)-1);
      }
      recalc();
    }));

    // simpler: add dedicated small handlers for the three visible bundle qty controls (we made two small buttons around ham qty input)
    // (Also allow manual edit)
    document.getElementById('bundle-ham-qty').addEventListener('change', ()=>{ // ensure gumbo zero if ham >0 and radio set
      if(n(document.getElementById('bundle-ham-qty').value)>0) document.querySelector('input[name="bundle"][value="ham"]').checked = true;
      recalc();
    });
    document.getElementById('bundle-gumbo-qty').addEventListener('change', ()=>{ if(n(document.getElementById('bundle-gumbo-qty').value)>0) document.querySelector('input[name="bundle"][value="gumbo"]').checked = true; recalc(); });

    // Reset
    document.getElementById('reset-order').addEventListener('click',()=>{
      document.querySelectorAll('.qty-input').forEach(i=>i.value = 0);
      document.querySelectorAll('select').forEach(s=>s.selectedIndex=0);
      document.querySelector('input[name="bundle"][value="none"]').checked = true;
      document.getElementById('bundle-ham-qty').value = 0;
      document.getElementById('bundle-gumbo-qty').value = 0;
      recalc();
    });

    // initial calc
    recalc();

    // jump
    document.getElementById('jump-order').addEventListener('click', ()=>{ window.scrollTo({top:document.getElementById('menu').offsetTop-20, behavior:'smooth'}); });

    // SUBMIT: validate bundle selections, ham-side rules, then show order preview with payment info
    document.getElementById('submit-order').addEventListener('click', ()=>{
      const name = document.getElementById('cust-name').value.trim();
      const contact = document.getElementById('cust-contact').value.trim();
      if(!name || !contact){ alert('Please enter your name and a phone or email.'); return; }

      const q = readQuantities();
      // require at least one item or a bundle
      const hasAny = Object.values(q).some(v=>v.qty>0);
      if(!hasAny){ alert('Please add at least one item or pick a bundle before submitting.'); return; }

      // If bundle-ham qty > 0 ensure bundle-ham-breakfast and bundle-ham-pie selected
      const hamBundleQty = q['bundle-ham'] ? q['bundle-ham'].qty : 0;
      const gumboBundleQty = q['bundle-gumbo'] ? q['bundle-gumbo'].qty : 0;
      if(hamBundleQty > 0){
        const bf = document.getElementById('bundle-ham-breakfast').value;
        const pie = document.getElementById('bundle-ham-pie').value;
        if(!bf || !pie){ alert('You selected Ham bundle(s). Please choose a breakfast and a pie for the Ham bundle.'); return; }
      }
      if(gumboBundleQty > 0){
        const bf = document.getElementById('bundle-gumbo-breakfast').value;
        const pie = document.getElementById('bundle-gumbo-pie').value;
        if(!bf || !pie){ alert('You selected Gumbo bundle(s). Please choose a breakfast and a pie for the Gumbo bundle.'); return; }
      }

      // ham-side validation: 2 sides per ham dinner
      const hamQty = q['ham'] ? q['ham'].qty : 0;
      if(hamQty > 0){
        const sides = ['side-mac','side-mashed','side-greenbeans','side-corn'];
        let totalSides = 0;
        sides.forEach(k=>{ if(q[k]) totalSides += q[k].qty; });
        const required = hamQty * 2;
        if(totalSides < required){ alert(`You ordered ${hamQty} ham dinner(s). Please add at least ${required} side portion(s).`); return; }
      }

      // Build order object
      const selections = {
        bundleHamBreakfast: document.getElementById('bundle-ham-breakfast').value,
        bundleHamPie: document.getElementById('bundle-ham-pie').value,
        bundleGumboBreakfast: document.getElementById('bundle-gumbo-breakfast').value,
        bundleGumboPie: document.getElementById('bundle-gumbo-pie').value
      };
      const order = { name, contact, paymentMethod: document.getElementById('payment-method').value, items: q, selections, subtotal: document.getElementById('subtotal').innerText, total: document.getElementById('total').innerText };

      // Payment text
      const VENMO_HANDLE = '@krismaths';
      const PAYPAL_LINK = 'mailto:krismaths5@gmail.com';
      const SQUARE_LINK = '(Square link will be sent after order submission)';

      let paymentHtml = '<div style="padding:12px">Please send payment to confirm your order:<ul>';
      if(order.paymentMethod === 'venmo') paymentHtml += `<li>Venmo: <strong>${VENMO_HANDLE}</strong></li>`;
      else if(order.paymentMethod === 'paypal') paymentHtml += `<li>PayPal (Friends & Family preferred): ${PAYPAL_LINK}</li>`;
      else paymentHtml += `<li>Card via Square: ${SQUARE_LINK}</li>`;
      paymentHtml += '</ul><p style="margin-top:6px">Orders confirmed once payment is received. Pickup Dec 24, 12–5pm (S. Wall Ave area).</p></div>';

      // Open preview window
      const win = window.open('','_blank','noopener');
      win.document.write('<html><head><title>Order Preview</title></head><body style="font-family:Raleway,Arial;padding:18px">');
      win.document.write('<h2 style="color:#4B3F4E">Order Preview</h2>');
      win.document.write('<pre>' + JSON.stringify(order, null, 2) + '</pre>');
      win.document.write(paymentHtml);
      win.document.write('<p style="color:#666;font-size:13px">This is an order request. Your order is only confirmed after payment.</p>');
      win.document.write('</body></html>');
      win.document.close();

      alert('Order request created — a new window has your order summary and payment instructions. Please complete payment to hold your slot.');
    });

    // Recalc whenever things change
    document.body.addEventListener('change', (e)=> recalc());
    // Also recalc on clicks of quantity +/- that are not standard inc/dec
    document.querySelectorAll('[data-bundle-qty]').forEach(b=>b.addEventListener('click', ()=> recalc()));
  </script>
</body>
</html>
